<?php class ControllerExtensionModuleSalesagent extends Controller{public function save(){$json=array();if(isset($this->request->post['salesagent_id'])&&$this->request->post['salesagent_id']){$this->session->data['salesagent_id']=$this->request->post['salesagent_id'];$this->saveTransactionSession();}else{unset($this->session->data['salesagent_id']);}$json['success']="Saved";$this->response->addHeader('Content-Type: application/json');$this->response->setOutput(json_encode($json));}public function agentcode(){$json=array();if(isset($this->request->get['uniqueid'])&&$this->request->get['uniqueid']){$this->load->model('extension/module/salesagent');$json=$this->model_extension_module_salesagent->checkUniqueId($this->request->get['uniqueid']);}$this->response->addHeader('Content-Type: application/json');$this->response->setOutput(json_encode($json));}public function saveTransactionAdd(&$route='',&$data=array(),&$output=''){$this->load->model("checkout/order");$order_id=intval($output);$order_info=$this->model_checkout_order->getOrder($order_id);if($this->config->get("salesagentdebug_status")){$this->log->write("SalesAgent Order Add Event Executed");}$this->load->model('extension/module/salesagent');$this->model_extension_module_salesagent->saveSalesAgentForOrder($order_id,$order_info['customer_id']);}public function saveTransactionEdit(&$route,&$args){if(isset($args[0])){$order_id=intval($args[0]);}else{$order_id=0;}if($order_id){$this->load->model("checkout/order");$order_info=$this->model_checkout_order->getOrder($order_id);if(isset($args[1])&&is_array($args[1])){$order_info=$args[1];}if($this->config->get("salesagentdebug_status")){$this->log->write("SalesAgent Order Edit Event Executed");}$this->load->model('extension/module/salesagent');$this->model_extension_module_salesagent->saveSalesAgentForOrder($order_id,$order_info['customer_id']);}}public function saveTransactionSession(&$route="",&$args=array()){if(isset($this->session->data['order_id'])&&$this->session->data['order_id']){$order_id=$this->session->data['order_id'];$this->load->model("checkout/order");$order_info=$this->model_checkout_order->getOrder($order_id);$this->load->model('extension/module/salesagent');$this->model_extension_module_salesagent->saveSalesAgentForOrder($order_id,$order_info['customer_id']);}}public function removeTransactionSession(){if(isset($this->session->data['order_id'])&&$this->session->data['order_id']){$order_id=$this->session->data['order_id'];}if($order_id){$this->load->model('extension/module/salesagent');$this->model_extension_module_salesagent->removeTransactionSession($order_id);}}public function addTransaction(&$route,&$args){if(isset($args[0])){$order_id=$args[0];}else{$order_id=0;}if(isset($args[1])){$order_status_id=$args[1];}else{$order_status_id=0;}$order_info=$this->model_checkout_order->getOrder($order_id);if(!$order_info['order_status_id']&&$order_status_id){if($this->config->get("salesagentdebug_status")){$this->log->write("SalesAgent Transaction Add Event Executed");}$this->load->model('extension/module/salesagent');$this->model_extension_module_salesagent->addtransaction($order_id,$order_info);}}public function unsetSalesagentSession(&$route='',&$args=array()){unset($this->session->data['uniqueid']);unset($this->session->data['salesagent_id']);}public function agentSelect($settings=array()){$data['saleagents']=array();$bit=0;if(isset($settings['route'])&&$settings['route']=='register'){if($this->config->get("salesagent_register")){$bit=1;}}if(isset($settings['route'])&&$settings['route']=='checkout'){if($this->config->get("salesagent_checkout")){$bit=1;}}$output=0;if(isset($settings['output'])&&$settings['output']){$output=1;}if($bit){$data['salesagent_selecttype']=$this->config->get("salesagent_selecttype");$this->load->model('extension/module/salesagent');$data['saleagents']=$this->model_extension_module_salesagent->getsalesagents();$this->load->language('extension/module/salesagent');$data['text_salesagent']=$this->language->get('text_salesagent');if($data['salesagent_selecttype']){$data['entry_salesagent']=$this->language->get('entry_salesagentcode');}else{$data['entry_salesagent']=$this->language->get('entry_salesagent');}if(isset($this->session->data['uniqueid'])){$data['uniqueid']=$this->session->data['uniqueid'];}else{$data['uniqueid']="";}$data['salesagent_id']=$this->model_extension_module_salesagent->getsalesagent();if($output){$this->response->setOutput($this->renderView('extension/module/salesagent'));}else{return $this->load->view('extension/module/salesagent',$data);}}}}